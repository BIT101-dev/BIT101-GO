<!--
 * @Author: flwfdd
 * @Date: 2023-03-15 15:19:46
 * @LastEditTime: 2023-10-10 20:40:43
 * @Description: _(:Ğ·ã€âˆ )_
-->
# BIT101-GO

`BIT101`çš„æ–°åç«¯ï¼ŒåŸºäº`GO`ã€‚

[APIæ–‡æ¡£](https://bit101-api.apifox.cn)

å¦‚æœå…¶ä»–åŒå­¦æœ‰éœ€è¦ç”¨åˆ°è¯¥é¡¹ç›®ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä½†éœ€è¦æ³¨æ˜ä½¿ç”¨äº†è¯¥é¡¹ç›®ï¼Œå¦å¤–è¿˜è¯·æ³¨æ„å¼€æºåè®®ã€‚æ–‡æ¡£ä¸­çš„è¯´æ˜å·²ç»æ¯”è¾ƒè¯¦å°½äº†ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿æ`issue`ã€‚

ğŸ¥³ä¹Ÿéå¸¸æ¬¢è¿ä½ æ¥è´¡çŒ®ä»£ç ï¼

æ€»ä¹‹ï¼Œå¸Œæœ›è¿™ä¸ªé¡¹ç›®èƒ½å¤Ÿå¸®åŠ©åˆ°å¤§å®¶( Â´â–½ï½€)


## éƒ¨ç½²æŒ‡å—

ä»¥`Ubuntu`ä¸ºä¾‹ã€‚

* å®‰è£…`PostgreSQL`å¹¶é…ç½®å¯åŠ¨
* å®‰è£…`Meilisearch`å¹¶é…ç½®å¯åŠ¨
* å®‰è£…`GO`å¹¶é…ç½®
* æ‰§è¡Œ`go build -o main main.go`ä»¥ç¼–è¯‘
* å¤åˆ¶`config_example.yaml`ä¸º`config.yaml`å¹¶é…ç½®

### æ•°æ®åº“é…ç½®

ä½¿ç”¨`postgresql`ä½œä¸ºæ•°æ®åº“ã€‚

```sql
CREATE USER bit101 WITH PASSWORD '*****';
CREATE DATABASE bit101 OWNER bit101;
GRANT ALL PRIVILEGES ON DATABASE bit101 TO bit101;
```

### æœç´¢ç³»ç»Ÿé…ç½®

ä½¿ç”¨`Meilisearch`ä½œä¸ºæœç´¢ç³»ç»Ÿã€‚å¯å‰å¾€[å®˜ç½‘é“¾æ¥](https://www.meilisearch.com/)æŸ¥çœ‹å®‰è£…å’Œå®ç”¨æ•™ç¨‹ã€‚

éƒ¨ç½²æ—¶è¿è¡Œï¼š
```shell
meilisearch --env production --master-key BIT101 --db-path ./data/meilisearch
```

å…¶ä¸­`master key`éœ€è¦å’Œ`config.yml`ä¸­å¯¹åº”ã€‚

### èº«ä»½éªŒè¯è¯´æ˜

ä½¿ç”¨`JWT`ä½œä¸ºèº«ä»½éªŒè¯çš„æ–¹å¼ï¼Œè¿™æ ·æœåŠ¡å™¨å°±ä¸ç”¨ç¼“å­˜ä»»ä½•ä¿¡æ¯ï¼Œåªè¦éªŒè¯æ•°å­—ç­¾åå°±å¯ä»¥ï¼Œæ•°å­—ç­¾åçš„å¯†é’¥åœ¨`config.yml`ä¸­é…ç½®ï¼Œç»å¯¹ä¸å¯ä»¥æ³„æ¼ã€‚ç™»å½•æˆåŠŸæ—¶ä¼šä¸‹å‘ä¸€ä¸ª`fake-cookie`ï¼Œä¹‹ååªéœ€è¦æ¯æ¬¡è¯·æ±‚æºå¸¦`fake-cookie`å¤´å³å¯ã€‚

### éƒ¨ç½²åˆ° Serverless ä»¥åŠä»£ç†è¯·æ±‚
`serverless`çš„åˆ†æ”¯ä¸­ä¸ºä¸“ä¾›`Serverless`å¹³å°ä½¿ç”¨çš„ç²¾ç®€ç‰ˆæœ¬ï¼Œå½“å‰åªç”¨äºæˆç»©æŸ¥è¯¢ã€‚

`BIT101-GO`å¯ä»¥éå¸¸ç®€å•åœ°éƒ¨ç½²åˆ°å‡½æ•°è®¡ç®—æœåŠ¡ä¸Šï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§è·¯ç”±å°†è¯·æ±‚è½¬å‘åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå®ç°åå‘ä»£ç†ã€‚

ä¸€ä¸ªå…¸å‹çš„åº”ç”¨æ˜¯ï¼ŒæŸ¥è¯¢æˆç»©è¯¦æƒ…éœ€è¦è¿›è¡Œå¤§é‡çš„è¯·æ±‚ï¼Œè¿™äº›è¯·æ±‚å¦‚æœåœ¨åŒä¸€å°æœºå™¨ä¸Šå®Œæˆå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒå¤§çš„å‹åŠ›ï¼Œäºæ˜¯å°±å¯ä»¥å°†æˆç»©æŸ¥è¯¢æ¥å£çš„è¯·æ±‚è½¬å‘ç»™å‡½æ•°è®¡ç®—ä»£ç†å®Œæˆã€‚

å¦‚æœåªæ˜¯å¿«æ·å¼€å…³å¹¶é…ç½®ä»£ç†é“¾æ¥ï¼Œæ›´æ”¹é…ç½®æ–‡ä»¶ä¸­çš„`proxy`å­—æ®µå³å¯ï¼Œä½†å¦‚æœè¦å®šä¹‰å“ªäº›æ¥å£éœ€è¦èµ°ä»£ç†ï¼Œéœ€è¦åœ¨`router`ä¸­æ·»åŠ è·ç§»é™¤ç‰¹å®šè·¯ç”±çš„`Proxy`ä¸­é—´ä»¶ï¼ˆé»˜è®¤å·²ç»åœ¨éƒ¨åˆ†æ¥å£æ·»åŠ äº†ä»£ç†ä¸­é—´ä»¶ï¼‰ã€‚

#### è…¾è®¯äº‘éƒ¨ç½²

åœ¨`Serverless`ä¸­æ–°å»ºå‡½æ•°æœåŠ¡ï¼Œé€‰æ‹©è¿è¡Œç¯å¢ƒä¸º`GO`çš„`Webå‡½æ•°`ã€‚

ç„¶åä½¿ç”¨å‘½ä»¤`GOOS=linux GOARCH=amd64 go build -o main main.go`ç¼–è¯‘ä¸ºç›®æ ‡å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¹Ÿå¯ä»¥åœ¨ç›¸åŒå¹³å°ä¸Šç›´æ¥ç¼–è¯‘ï¼‰ï¼Œå†å°†ç”Ÿæˆçš„`main`å¯æ‰§è¡Œæ–‡ä»¶ã€`config.yaml`å’Œä¸€ä¸ªæ–‡ä»¶åä¸º`scf_bootstrap`çš„æ–‡ä»¶æ‰“æˆä¸€ä¸ªå‹ç¼©åŒ…ä¸Šä¼ å³å¯ã€‚å…¶ä¸­`scf_bootstrap`æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š
```bash
#!/bin/bash

./main
```
è¿™æ ·å°±å°†`BIT101-GO`éƒ¨ç½²åˆ°äº†`Serverless`å¹³å°ä¸Šã€‚

å¦å¤–éœ€è¦æ³¨æ„å‡½æ•°é…ç½®ä¸­å‡ ä¸ªå‚æ•°çš„è®¾ç½®ï¼šè¶…æ—¶æ—¶é—´ã€è¯·æ±‚å¤šå¹¶å‘ç­‰ã€‚

## ä½¿ç”¨æ–¹æ³•

å‡è®¾ç¼–è¯‘åç¨‹åºä¸º`main`
* å¼€å¯æœåŠ¡ï¼š`./main`æˆ–`./main server`
* å¯¼å…¥è¯¾ç¨‹è¡¨ï¼š`./main import_course [path]`ï¼Œå…¶ä¸­`path`ä¸ºè¯¾ç¨‹è¡¨`.csv`æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œé»˜è®¤ä¸º`./data/course/`
* è·å–è¯¾ç¨‹å†å²ï¼š`./main course_history [start_year] [end_year] [webvpn_cookie]`ï¼Œç°é˜¶æ®µæµ‹è¯•æœ€æ—©çš„è¯¾ç¨‹å†å²ä¸º`2005-2006`å­¦å¹´

## æ€§èƒ½æµ‹è¯•

ä½¿ç”¨`ab -n 1000 -c 100`è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œä¸ºæ’é™¤ç½‘ç»œå½±å“ï¼Œå‡ä¸ºåŒä¸€å°æœåŠ¡å™¨æœ¬æœºè¿è¡Œæµ‹è¯•ã€‚

é¦–å…ˆæµ‹è¯•äº†ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ¥å£ã€‚

è€`Python`åç«¯ç»“æœï¼š

```shell
Document Path:          /reaction/comments/?obj=paper1&order=default&page=0
Document Length:        17314 bytes

Concurrency Level:      100
Time taken for tests:   44.034 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      17494000 bytes
HTML transferred:       17314000 bytes
Requests per second:    22.71 [#/sec] (mean)
Time per request:       4403.378 [ms] (mean)
Time per request:       44.034 [ms] (mean, across all concurrent requests)
Transfer rate:          387.97 [Kbytes/sec] received
```

æ–°`GO`åç«¯ç»“æœï¼š
```shell
Document Path:          /reaction/comments?obj=paper1&order=default&page=0
Document Length:        18019 bytes

Concurrency Level:      100
Time taken for tests:   2.939 seconds
Complete requests:      1000
Failed requests:        106
   (Connect: 0, Receive: 0, Length: 106, Exceptions: 0)
Total transferred:      18121202 bytes
HTML transferred:       18018202 bytes
Requests per second:    340.31 [#/sec] (mean)
Time per request:       293.851 [ms] (mean)
Time per request:       2.939 [ms] (mean, across all concurrent requests)
Transfer rate:          6022.28 [Kbytes/sec] received
```

ä¸€é€šæµ‹è¯•çŒ›å¦‚è™ï¼Œç»“æœéå¸¸ AMAZING å•Šï¼Œè€ã€æ–°åç«¯åœ¨è¯¥æ¥å£ä¸Šçš„ç§’å¹¶å‘åˆ†åˆ«ä¸º`22.71`ã€`340.31`ï¼Œæå‡äº†çº¦**15å€**ï¼ï¼ï¼ï¼ˆç„¶è€Œå½“å‰å®é™…åœºæ™¯ä¸­æœåŠ¡å™¨å¸¦å®½åè€Œæˆä¸ºç“¶é¢ˆäº†ï¼‰

åˆæµ‹è¯•äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„æ¥å£ï¼ˆä»…åŒ…å«ä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢ï¼‰ï¼Œè€ã€æ–°åç«¯ç§’å¹¶å‘åˆ†åˆ«ä¸º`708`ã€`955`ï¼Œä»ç„¶ä¸€å®šçš„æå‡ã€‚
